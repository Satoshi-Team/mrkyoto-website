<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Direct Weather Test</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .weather-widget { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 10px; margin: 20px 0; }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-4xl mx-auto">
        <h1 class="text-3xl font-bold mb-8">ğŸŒ¤ï¸ Direct Weather Test</h1>
        
        <button onclick="loadWeather()" class="bg-blue-500 text-white px-4 py-2 rounded mb-4">Load Weather Data</button>
        
        <!-- Weather Widget (same structure as live-from-kyoto) -->
        <div class="weather-widget">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold">Kyoto Weather</h2>
                <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <span class="w-2 h-2 bg-green-400 rounded-full mr-1 animate-pulse"></span>
                    <span>LIVE</span>
                </span>
            </div>
            
            <div id="kyoto-weather-widget" class="space-y-4">
                <!-- Current Weather -->
                <div class="text-center">
                    <div class="text-4xl font-bold text-blue-600 dark:text-blue-400 mb-2" id="weather-temperature">
                        --Â°C
                    </div>
                    <div class="text-6xl mb-3" id="weather-icon">
                        ğŸŒ¤ï¸
                    </div>
                    <div class="text-sm text-gray-600 mb-2" id="weather-description">
                        Loading weather...
                    </div>
                    <div class="text-xs text-gray-500" id="weather-feels-like">
                        Feels like --Â°C
                    </div>
                </div>
                
                <!-- Weather Details Grid -->
                <div class="grid grid-cols-2 gap-3 text-xs">
                    <div class="flex items-center justify-between p-2 bg-white/50 rounded-lg">
                        <div class="flex items-center">
                            <span class="mr-2">ğŸ’¨</span>
                            <span>Wind</span>
                        </div>
                        <span class="font-semibold" id="weather-wind">-- km/h</span>
                    </div>
                    <div class="flex items-center justify-between p-2 bg-white/50 rounded-lg">
                        <div class="flex items-center">
                            <span class="mr-2">ğŸ’§</span>
                            <span>Humidity</span>
                        </div>
                        <span class="font-semibold" id="weather-humidity">--%</span>
                    </div>
                    <div class="flex items-center justify-between p-2 bg-white/50 rounded-lg">
                        <div class="flex items-center">
                            <span class="mr-2">ğŸ‘ï¸</span>
                            <span>Visibility</span>
                        </div>
                        <span class="font-semibold" id="weather-visibility">-- km</span>
                    </div>
                    <div class="flex items-center justify-between p-2 bg-white/50 rounded-lg">
                        <div class="flex items-center">
                            <span class="mr-2">ğŸŒ¡ï¸</span>
                            <span>Pressure</span>
                        </div>
                        <span class="font-semibold" id="weather-pressure">-- hPa</span>
                    </div>
                </div>
                
                <!-- Sunrise/Sunset -->
                <div class="flex items-center justify-between p-3 bg-gradient-to-r from-yellow-500/20 to-orange-500/20 rounded-lg border border-yellow-400/30">
                    <div class="flex items-center">
                        <span class="text-xl mr-2">ğŸŒ…</span>
                        <div>
                            <div class="text-xs text-gray-500">Sunrise</div>
                            <div class="font-semibold text-sm" id="weather-sunrise">--:--</div>
                        </div>
                    </div>
                    <div class="flex items-center">
                        <div class="text-right">
                            <div class="text-xs text-gray-500">Sunset</div>
                            <div class="font-semibold text-sm" id="weather-sunset">--:--</div>
                        </div>
                        <span class="text-xl ml-2">ğŸŒ‡</span>
                    </div>
                </div>
                
                <!-- Last Updated -->
                <div class="text-center text-xs text-gray-400">
                    Last updated: <span id="weather-last-updated">--:--</span>
                </div>
            </div>
        </div>
        
        <!-- Debug Info -->
        <div class="bg-white p-4 rounded-lg shadow mt-8">
            <h3 class="font-semibold mb-2">Debug Information</h3>
            <div id="debug-info" class="text-sm text-gray-600">
                Ready to test...
            </div>
        </div>
        
        <!-- Console Output -->
        <div class="bg-black text-green-400 p-4 rounded-lg mt-4 font-mono text-sm">
            <div class="font-bold mb-2">Console Output:</div>
            <div id="console-output">
                <div>Console ready...</div>
            </div>
        </div>
    </div>

    <script>
        function log(message) {
            const consoleOutput = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString();
            consoleOutput.innerHTML += `<div>[${timestamp}] ${message}</div>`;
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        function updateDebugInfo(info) {
            document.getElementById('debug-info').innerHTML = info;
        }

        function getWeatherIcon(iconCode) {
            const icons = {
                '01d': 'â˜€ï¸', '01n': 'ğŸŒ™', '02d': 'â›…', '02n': 'â˜ï¸',
                '03d': 'â˜ï¸', '03n': 'â˜ï¸', '04d': 'â˜ï¸', '04n': 'â˜ï¸',
                '09d': 'ğŸŒ§ï¸', '09n': 'ğŸŒ§ï¸', '10d': 'ğŸŒ¦ï¸', '10n': 'ğŸŒ§ï¸',
                '11d': 'â›ˆï¸', '11n': 'â›ˆï¸', '13d': 'ğŸŒ¨ï¸', '13n': 'ğŸŒ¨ï¸',
                '50d': 'ğŸŒ«ï¸', '50n': 'ğŸŒ«ï¸'
            };
            return icons[iconCode] || 'ğŸŒ¤ï¸';
        }

        function getWeatherDescription(code) {
            const descriptions = {
                0: 'Clear sky',
                1: 'Mainly clear',
                2: 'Partly cloudy',
                3: 'Overcast',
                45: 'Foggy',
                48: 'Depositing rime fog',
                51: 'Light drizzle',
                53: 'Moderate drizzle',
                55: 'Dense drizzle',
                56: 'Light freezing drizzle',
                57: 'Dense freezing drizzle',
                61: 'Slight rain',
                63: 'Moderate rain',
                65: 'Heavy rain',
                66: 'Light freezing rain',
                67: 'Heavy freezing rain',
                71: 'Slight snow fall',
                73: 'Moderate snow fall',
                75: 'Heavy snow fall',
                77: 'Snow grains',
                80: 'Slight rain showers',
                81: 'Moderate rain showers',
                82: 'Violent rain showers',
                85: 'Slight snow showers',
                86: 'Heavy snow showers',
                95: 'Thunderstorm',
                96: 'Thunderstorm with slight hail',
                99: 'Thunderstorm with heavy hail'
            };
            return descriptions[code] || 'Clear sky';
        }

        function convertWeatherCodeToIcon(code) {
            const iconMap = {
                0: '01d', 1: '01d', 2: '02d', 3: '03d',
                45: '50d', 48: '50d',
                51: '09d', 53: '09d', 55: '09d', 56: '09d', 57: '09d',
                61: '10d', 63: '10d', 65: '10d', 66: '10d', 67: '10d',
                71: '13d', 73: '13d', 75: '13d', 77: '13d',
                80: '09d', 81: '10d', 82: '10d',
                85: '13d', 86: '13d',
                95: '11d', 96: '11d', 99: '11d'
            };
            return iconMap[code] || '01d';
        }

        async function loadWeather() {
            log('ğŸŒ¤ï¸ Loading weather data directly...');
            updateDebugInfo('Loading weather data...');
            
            try {
                const response = await fetch('https://api.open-meteo.com/v1/forecast?latitude=35.0116&longitude=135.7681&current=temperature_2m,relative_humidity_2m,apparent_temperature,precipitation,weather_code,wind_speed_10m,pressure_msl&timezone=auto');
                
                if (response.ok) {
                    const data = await response.json();
                    log('âœ… Weather data received');
                    log(`ğŸŒ¡ï¸ Raw temperature: ${data.current.temperature_2m}Â°C`);
                    log(`ğŸ’§ Raw humidity: ${data.current.relative_humidity_2m}%`);
                    log(`ğŸ’¨ Raw wind: ${data.current.wind_speed_10m} km/h`);
                    log(`ğŸŒ¡ï¸ Raw pressure: ${data.current.pressure_msl} hPa`);
                    
                    const current = data.current;
                    
                    // Calculate sunrise and sunset times for Kyoto
                    const now = new Date();
                    const sunrise = new Date(now);
                    sunrise.setHours(6, 30, 0, 0); // Approximate sunrise time
                    const sunset = new Date(now);
                    sunset.setHours(17, 30, 0, 0); // Approximate sunset time
                    
                    const weatherData = {
                        temperature: Math.round(current.temperature_2m),
                        feelsLike: Math.round(current.apparent_temperature),
                        humidity: current.relative_humidity_2m,
                        description: getWeatherDescription(current.weather_code),
                        icon: convertWeatherCodeToIcon(current.weather_code),
                        windSpeed: Math.round(current.wind_speed_10m),
                        pressure: Math.round(current.pressure_msl),
                        visibility: 10, // Default visibility
                        sunrise: sunrise,
                        sunset: sunset
                    };
                    
                    log('ğŸŒ¤ï¸ Processed weather data:');
                    log(`ğŸŒ¡ï¸ Temperature: ${weatherData.temperature}Â°C`);
                    log(`ğŸ’§ Humidity: ${weatherData.humidity}%`);
                    log(`ğŸ’¨ Wind: ${weatherData.windSpeed} km/h`);
                    log(`ğŸŒ¡ï¸ Pressure: ${weatherData.pressure} hPa`);
                    log(`ğŸŒ¤ï¸ Description: ${weatherData.description}`);
                    
                    // Update DOM elements directly
                    log('ğŸ–¥ï¸ Updating DOM elements...');
                    
                    const temperatureEl = document.getElementById('weather-temperature');
                    const iconEl = document.getElementById('weather-icon');
                    const descriptionEl = document.getElementById('weather-description');
                    const feelsLikeEl = document.getElementById('weather-feels-like');
                    const windEl = document.getElementById('weather-wind');
                    const humidityEl = document.getElementById('weather-humidity');
                    const visibilityEl = document.getElementById('weather-visibility');
                    const pressureEl = document.getElementById('weather-pressure');
                    const sunriseEl = document.getElementById('weather-sunrise');
                    const sunsetEl = document.getElementById('weather-sunset');
                    const lastUpdatedEl = document.getElementById('weather-last-updated');
                    
                    log('ğŸ” Found elements:');
                    log(`Temperature: ${!!temperatureEl}`);
                    log(`Icon: ${!!iconEl}`);
                    log(`Description: ${!!descriptionEl}`);
                    log(`Feels Like: ${!!feelsLikeEl}`);
                    log(`Wind: ${!!windEl}`);
                    log(`Humidity: ${!!humidityEl}`);
                    log(`Visibility: ${!!visibilityEl}`);
                    log(`Pressure: ${!!pressureEl}`);
                    log(`Sunrise: ${!!sunriseEl}`);
                    log(`Sunset: ${!!sunsetEl}`);
                    log(`Last Updated: ${!!lastUpdatedEl}`);
                    
                    if (temperatureEl) {
                        temperatureEl.textContent = `${weatherData.temperature}Â°C`;
                        log('âœ… Updated temperature');
                    }
                    if (iconEl) {
                        iconEl.textContent = getWeatherIcon(weatherData.icon);
                        log('âœ… Updated icon');
                    }
                    if (descriptionEl) {
                        descriptionEl.textContent = weatherData.description;
                        log('âœ… Updated description');
                    }
                    if (feelsLikeEl) {
                        feelsLikeEl.textContent = `Feels like ${weatherData.feelsLike}Â°C`;
                        log('âœ… Updated feels like');
                    }
                    if (windEl) {
                        windEl.textContent = `${weatherData.windSpeed} km/h`;
                        log('âœ… Updated wind');
                    }
                    if (humidityEl) {
                        humidityEl.textContent = `${weatherData.humidity}%`;
                        log('âœ… Updated humidity');
                    }
                    if (visibilityEl) {
                        visibilityEl.textContent = `${weatherData.visibility} km`;
                        log('âœ… Updated visibility');
                    }
                    if (pressureEl) {
                        pressureEl.textContent = `${weatherData.pressure} hPa`;
                        log('âœ… Updated pressure');
                    }
                    if (sunriseEl) {
                        sunriseEl.textContent = weatherData.sunrise.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
                        log('âœ… Updated sunrise');
                    }
                    if (sunsetEl) {
                        sunsetEl.textContent = weatherData.sunset.toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
                        log('âœ… Updated sunset');
                    }
                    if (lastUpdatedEl) {
                        lastUpdatedEl.textContent = new Date().toLocaleTimeString('en-US', {hour: '2-digit', minute: '2-digit'});
                        log('âœ… Updated last updated time');
                    }
                    
                    updateDebugInfo('Weather data loaded and displayed successfully!');
                    log('ğŸ‰ Weather display update complete');
                    
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                log(`âŒ Error loading weather: ${error.message}`);
                updateDebugInfo(`Error loading weather: ${error.message}`);
            }
        }

        // Auto-load weather on page load
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ Direct weather test page loaded');
            log('ğŸŒ¤ï¸ Ready to test weather loading');
            updateDebugInfo('Ready to test weather loading. Click the button or wait for auto-load...');
            
            // Auto-load after 2 seconds
            setTimeout(() => {
                log('ğŸ”„ Auto-loading weather data...');
                loadWeather();
            }, 2000);
        });
    </script>
</body>
</html> 